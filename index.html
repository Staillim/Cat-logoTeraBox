<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat√°logo TeraBox</title>
  <link rel="stylesheet" href="estilo.css">
  <style>
    /* ================= Banner Slider ================= */
    #banner {
      position: relative;
      width: 100%;
      height: 250px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    #banner a {
      display: block;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      text-decoration: none;
    }
    #banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }
    #banner img.active {
      opacity: 1;
    }

    /* ================= Secci√≥n Estrenos ================= */
    #estrenos {
      margin: 15px 0;
    }
    #estrenos h2 {
      font-size: 1.2rem;
      margin: 10px;
      color: #fff;
    }
    #estrenos-container {
      display: flex;
      overflow-x: auto;
      flex-wrap: nowrap;
      gap: 12px;
      padding: 0 10px;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #estrenos-container::-webkit-scrollbar {
      display: none;
    }
    #estrenos-container .movie-card {
      background: none;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
      flex: 0 0 auto;
      width: 150px;
    }
    #estrenos-container .movie-card:hover {
      transform: scale(1.05);
    }
    #estrenos-container .movie-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    #estrenos-container .movie-card .info {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      padding: 5px;
      text-align: center;
      box-sizing: border-box;
    }
    #estrenos-container .movie-card .info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #fff;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #estrenos-container .type-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0, 102, 204, 0.7);
      color: white;
      padding: 3px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ================= Secci√≥n Agregado Recientemente ================= */
    #recently-added-section {
      margin: 15px 0;
    }
    #recently-added-section h2 {
      font-size: 1.2rem;
      margin: 10px;
      color: #fff;
    }
    #recently-added-container {
      display: flex;
      overflow-x: auto;
      flex-wrap: nowrap;
      gap: 8px;
      padding: 0 10px;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #recently-added-container::-webkit-scrollbar {
      display: none;
    }
    #recently-added-container .movie-card {
      background: none;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
      flex: 0 0 auto;
      width: 120px;
    }
    #recently-added-container .movie-card:hover {
      transform: scale(1.05);
    }
    #recently-added-container .movie-card img {
      width: 100%;
      height: 180px;
      object-fit: contain;
    }
    #recently-added-container .movie-card .info {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      padding: 5px;
      text-align: center;
      box-sizing: border-box;
    }
    #recently-added-container .movie-card .info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #fff;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #recently-added-container .type-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0, 102, 204, 0.7);
      color: white;
      padding: 3px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ================= Secci√≥n Series ================= */
    #series {
      margin: 15px 0;
    }
    #series h2 {
      font-size: 1.2rem;
      margin: 10px;
      color: #fff;
    }
    #series-container {
      display: flex;
      overflow-x: auto;
      flex-wrap: nowrap;
      gap: 12px;
      padding: 0 10px;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #series-container::-webkit-scrollbar {
      display: none;
    }
    #series-container .movie-card {
      background: none;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
      flex: 0 0 auto;
      width: 150px;
    }
    #series-container .movie-card:hover {
      transform: scale(1.05);
    }
    #series-container .movie-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    #series-container .movie-card .info {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      padding: 5px;
      text-align: center;
      box-sizing: border-box;
    }
    #series-container .movie-card .info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #fff;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #series-container .type-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0, 102, 204, 0.7);
      color: white;
      padding: 3px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ================= Nuevos Carruseles (Aventura, Acci√≥n, Comedia, Terror) ================= */
    #aventura, #accion, #comedia, #terror {
      margin: 15px 0;
    }
    #aventura h2, #accion h2, #comedia h2, #terror h2 {
      font-size: 1.2rem;
      margin: 10px;
      color: #fff;
    }
    #aventura-container, #accion-container, #comedia-container, #terror-container {
      display: flex;
      overflow-x: auto;
      flex-wrap: nowrap;
      gap: 12px;
      padding: 0 10px;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #aventura-container::-webkit-scrollbar, #accion-container::-webkit-scrollbar,
    #comedia-container::-webkit-scrollbar, #terror-container::-webkit-scrollbar {
      display: none;
    }
    #aventura-container .movie-card, #accion-container .movie-card,
    #comedia-container .movie-card, #terror-container .movie-card {
      background: none;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
      flex: 0 0 auto;
      width: 150px;
    }
    #aventura-container .movie-card:hover, #accion-container .movie-card:hover,
    #comedia-container .movie-card:hover, #terror-container .movie-card:hover {
      transform: scale(1.05);
    }
    #aventura-container .movie-card img, #accion-container .movie-card img,
    #comedia-container .movie-card img, #terror-container .movie-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    #aventura-container .movie-card .info, #accion-container .movie-card .info,
    #comedia-container .movie-card .info, #terror-container .movie-card .info {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      padding: 5px;
      text-align: center;
      box-sizing: border-box;
    }
    #aventura-container .movie-card .info h4, #accion-container .movie-card .info h4,
    #comedia-container .movie-card .info h4, #terror-container .movie-card .info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #fff;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #aventura-container .type-badge, #accion-container .type-badge,
    #comedia-container .type-badge, #terror-container .type-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0, 102, 204, 0.7);
      color: white;
      padding: 3px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ================= Secci√≥n Categor√≠as (Men√∫ Hamburguesa) ================= */
    header {
      background: #111;
      padding: 10px 20px;
      position: relative;
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      position: relative;
    }
    .header-top h1 {
      margin: 0;
      color: #fff;
      font-size: 1.8rem;
      flex-grow: 1;
      text-align: center;
    }
    .hamburger-menu {
      position: absolute;
      left: 20px;
    }
    #hamburger-toggle {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: #fff;
      cursor: pointer;
      padding: 5px 10px;
    }
    #categories-menu {
      display: none;
      position: absolute;
      top: 60px;
      left: 20px;
      background: #222;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 10;
      width: 200px;
    }
    #categories-menu.active {
      display: block;
    }
    .category-button {
      display: block;
      width: 100%;
      background-color: #333;
      color: #fff;
      border: none;
      padding: 10px;
      cursor: pointer;
      text-transform: capitalize;
      transition: background 0.3s;
      text-align: left;
    }
    .category-button:hover {
      background-color: #444;
    }
    .category-button.active {
      background-color: #379ad3;
    }
    .search-container {
      display: flex;
      justify-content: center;
    }
    #search-bar {
      padding: 8px;
      width: 200px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    /* ================= Secci√≥n Resultados de Categor√≠as ================= */
    #category-results {
      margin: 20px;
    }
    .movies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
      padding: 0 10px;
    }
    #category-results .movie-card {
      background: none;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
    }
    #category-results .movie-card:hover {
      transform: scale(1.05);
    }
    #category-results .movie-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    #category-results .movie-card .info {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      padding: 5px;
      text-align: center;
      box-sizing: border-box;
    }
    #category-results .movie-card .info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #fff;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    }
    #category-results .type-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0, 102, 204, 0.7);
      color: white;
      padding: 3px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ================= App Download ================= */
    #app-download {
      text-align: center;
      padding: 20px;
      background-color: #222;
    }
    #download-app {
      font-size: 1.2rem;
      color: #fff;
      text-decoration: none;
      padding: 10px 20px;
      border: 2px solid #fff;
      border-radius: 4px;
      transition: background 0.3s, color 0.3s;
    }
    #download-app:hover {
      background-color: #fff;
      color: #222;
    }

    /* ================= Footer ================= */
    footer {
      text-align: center;
      padding: 20px;
      background: #111;
      color: #fff;
      margin-top: 20px;
    }

    /* ================= Error Message ================= */
    .error-message {
      text-align: center;
      color: #ff5555;
      padding: 20px;
      font-size: 1.2rem;
    }

    /* ================= Imagen de respaldo ================= */
    .movie-card img:not([src]) {
      background: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.8rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-top">
      <div class="hamburger-menu">
        <button id="hamburger-toggle">‚ò∞</button>
      </div>
      <h1>Cat√°logo TeraBox</h1>
      <div id="categories-menu"></div>
    </div>
    <div class="search-container">
      <input type="text" id="search-bar" placeholder="Buscar pel√≠cula por nombre...">
    </div>
  </header>

  <!-- Secci√≥n Resultados de Categor√≠as -->
  <section id="category-results" class="movies-grid"></section>

  <!-- Banner Slider -->
  <section id="banner"></section>

  <!-- Secci√≥n Estrenos -->
  <section id="estrenos">
    <h2>üé¨ Estrenos 2025</h2>
    <div id="estrenos-container"></div>
  </section>

  <!-- Secci√≥n Agregado Recientemente -->
  <section id="recently-added-section">
    <h2>Agregado recientemente</h2>
    <div id="recently-added-container"></div>
  </section>

  <!-- Secci√≥n Series -->
  <section id="series">
    <h2>Series</h2>
    <div id="series-container"></div>
  </section>

  <!-- Secci√≥n Aventura -->
  <section id="aventura">
    <h2>Aventura</h2>
    <div id="aventura-container"></div>
  </section>

  <!-- Secci√≥n Acci√≥n -->
  <section id="accion">
    <h2>Acci√≥n</h2>
    <div id="accion-container"></div>
  </section>

  <!-- Secci√≥n Comedia -->
  <section id="comedia">
    <h2>Comedia</h2>
    <div id="comedia-container"></div>
  </section>

  <!-- Secci√≥n Terror -->
  <section id="terror">
    <h2>Terror</h2>
    <div id="terror-container"></div>
  </section>

  <!-- Secci√≥n Descargar App -->
  <section id="app-download">
    <a href="#" id="download-app">Descargar la App</a>
  </section>

  <!-- Footer -->
  <footer>
    <p>¬© 2025 Cat√°logo TeraBox. Todos los derechos reservados.</p>
  </footer>

  <script>
    let todasLasPeliculas = [];
    let generoSeleccionado = null;
    let textoBusqueda = '';

    // Normalizar texto
    function normalizeString(str) {
      return str ? str.trim().toLowerCase() : '';
    }

    // Renderizar tarjetas de pel√≠culas
    function renderMovies(moviesArray, container, cardWidth = '150px') {
      container.innerHTML = '';
      if (!moviesArray || moviesArray.length === 0) {
        container.innerHTML = '<p class="error-message">No se encontraron pel√≠culas</p>';
        return;
      }
      moviesArray.forEach(p => {
        if (!p || !p.ID || !p.NOMBRE || !p.IMG || !p.TIPO) return; // Validar campos
        const card = document.createElement('a');
        card.className = 'movie-card';
        card.href = `pelicula.html?id=${p.ID}`;
        card.style.width = cardWidth;
        card.innerHTML = `
          <span class="type-badge">${p.TIPO}</span>
          <img src="${p.IMG}" alt="${p.NOMBRE}" onerror="this.src=''; this.parentElement.querySelector('.info h4').textContent='Imagen no disponible';">
          <div class="info">
            <h4>${p.NOMBRE}</h4>
          </div>`;
        container.appendChild(card);
      });
    }

    // Renderizar banner (todas las pel√≠culas con FONDO)
    function renderBanner(movies) {
      const bannerContainer = document.getElementById('banner');
      const bannerMovies = movies.filter(p => p && p.FONDO); // Use all movies with FONDO
      bannerContainer.innerHTML = '';
      if (bannerMovies.length === 0) {
        bannerContainer.style.display = 'none';
        return;
      }
      bannerMovies.forEach((p, index) => {
        const link = document.createElement('a');
        link.href = `pelicula.html?id=${p.ID}`;
        const img = document.createElement('img');
        img.src = p.FONDO;
        img.alt = p.NOMBRE;
        img.onerror = () => { img.src = ''; };
        if (index === 0) img.classList.add('active');
        link.appendChild(img);
        bannerContainer.appendChild(link);
      });
      let currentIndex = 0;
      const images = bannerContainer.querySelectorAll('img');
      setInterval(() => {
        images[currentIndex].classList.remove('active');
        currentIndex = (currentIndex + 1) % images.length;
        images[currentIndex].classList.add('active');
      }, 3000);
    }

    // Renderizar estrenos (pel√≠culas de 2025)
    function renderEstrenos(movies) {
      const container = document.getElementById('estrenos-container');
      const estrenos = movies.filter(p => p && (p.A√ëO === 2025 || p.A√ëO === '2025')); // Only 2025 movies
      renderMovies(estrenos, container, '150px');
      autoScroll(container);
    }

    // Renderizar recientemente agregados (√∫ltimas 10 por ID)
    function renderRecentlyAdded(movies) {
      const container = document.getElementById('recently-added-container');
      const recent = movies.sort((a, b) => (b.ID || 0) - (a.ID || 0)).slice(0, 10); // Last 10 by ID
      renderMovies(recent, container, '120px');
      autoScroll(container);
    }

    // Renderizar series
    function renderSeries(movies) {
      const container = document.getElementById('series-container');
      const series = movies.filter(p => p && p.TIPO === 'SERIE');
      if (series.length === 0) {
        document.getElementById('series').style.display = 'none';
        return;
      }
      renderMovies(series, container, '150px');
      autoScroll(container);
    }

    // Renderizar aventura
    function renderAventura(movies) {
      const container = document.getElementById('aventura-container');
      const aventura = movies.filter(p => p && p.GENERO && p.GENERO.split('/').map(g => normalizeString(g.trim())).includes('aventura'));
      if (aventura.length === 0) {
        document.getElementById('aventura').style.display = 'none';
        return;
      }
      renderMovies(aventura, container, '150px');
      autoScroll(container);
    }

    // Renderizar acci√≥n
    function renderAccion(movies) {
      const container = document.getElementById('accion-container');
      const accion = movies.filter(p => p && p.GENERO && p.GENERO.split('/').map(g => normalizeString(g.trim())).includes('accion'));
      if (accion.length === 0) {
        document.getElementById('accion').style.display = 'none';
        return;
      }
      renderMovies(accion, container, '150px');
      autoScroll(container);
    }

    // Renderizar comedia
    function renderComedia(movies) {
      const container = document.getElementById('comedia-container');
      const comedia = movies.filter(p => p && p.GENERO && p.GENERO.split('/').map(g => normalizeString(g.trim())).includes('comedia'));
      if (comedia.length === 0) {
        document.getElementById('comedia').style.display = 'none';
        return;
      }
      renderMovies(comedia, container, '150px');
      autoScroll(container);
    }

    // Renderizar terror
    function renderTerror(movies) {
      const container = document.getElementById('terror-container');
      const terror = movies.filter(p => p && p.GENERO && p.GENERO.split('/').map(g => normalizeString(g.trim())).includes('terror'));
      if (terror.length === 0) {
        document.getElementById('terror').style.display = 'none';
        return;
      }
      renderMovies(terror, container, '150px');
      autoScroll(container);
    }

    // Auto-scroll para contenedores
    function autoScroll(container) {
      if (container._autoScrollInterval || !container.firstElementChild) return;
      const firstCard = container.firstElementChild;
      const gap = parseInt(getComputedStyle(container).gap) || 12;
      const scrollAmount = firstCard ? firstCard.clientWidth + gap : 0;
      container._autoScrollInterval = setInterval(() => {
        if (Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth - 1) {
          container.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        }
      }, 5000);
    }

    // Renderizar botones de categor√≠as
    function renderCategories(movies) {
      const cont = document.getElementById('categories-menu');
      const setG = new Set();
      movies.forEach(p => {
        if (p && p.GENERO) {
          p.GENERO.split('/').map(g => g.trim()).forEach(g => setG.add(g));
        }
      });
      cont.innerHTML = `<button class="category-button active" data-genero="">Todas</button>`;
      Array.from(setG).sort().forEach(g => {
        cont.innerHTML += `<button class="category-button" data-genero="${g}">${g}</button>`;
      });
      cont.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          if (generoSeleccionado === btn.dataset.genero) {
            generoSeleccionado = null; // Desactivar filtro
            cont.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          } else {
            generoSeleccionado = btn.dataset.genero;
            cont.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          }
          textoBusqueda = '';
          document.getElementById('search-bar').value = '';
          cont.classList.remove('active'); // Cerrar men√∫ al seleccionar
          aplicarFiltros();
        });
      });
    }

    // Aplicar filtros
    function aplicarFiltros() {
      const filtradas = todasLasPeliculas.filter(p => {
        if (!p || !p.NOMBRE || !p.GENERO) return false;
        const okName = normalizeString(p.NOMBRE).includes(normalizeString(textoBusqueda));
        const gens = p.GENERO.split('/').map(g => normalizeString(g.trim()));
        const okGen = generoSeleccionado === null || generoSeleccionado === '' || gens.includes(normalizeString(generoSeleccionado));
        return okName && okGen;
      });
      const secciones = [
        document.getElementById('banner'),
        document.getElementById('estrenos'),
        document.getElementById('recently-added-section'),
        document.getElementById('series'),
        document.getElementById('aventura'),
        document.getElementById('accion'),
        document.getElementById('comedia'),
        document.getElementById('terror')
      ];
      const categoryResults = document.getElementById('category-results');
      if (textoBusqueda || generoSeleccionado !== null) {
        secciones.forEach(s => s.style.display = 'none');
        renderMovies(filtradas, categoryResults, '150px');
      } else {
        secciones.forEach(s => s.style.display = '');
        categoryResults.innerHTML = '';
      }
      console.log('Pel√≠culas filtradas:', filtradas);
    }

    // Configurar buscador
    document.getElementById('search-bar').addEventListener('input', e => {
      textoBusqueda = e.target.value;
      aplicarFiltros();
    });

    // Configurar men√∫ hamburguesa
    document.getElementById('hamburger-toggle').addEventListener('click', () => {
      const menu = document.getElementById('categories-menu');
      menu.classList.toggle('active');
    });

    // Cargar datos y renderizar
    document.addEventListener('DOMContentLoaded', () => {
      fetch('https://raw.githubusercontent.com/Staillim/Mybase/main/base2.json')
        .then(r => {
          if (!r.ok) throw new Error(`Error HTTP: ${r.status}`);
          return r.json();
        })
        .then(data => {
          console.log('Datos cargados:', data);
          todasLasPeliculas = Array.isArray(data) ? data : [];
          if (todasLasPeliculas.length === 0) {
            document.getElementById('category-results').innerHTML = '<p class="error-message">No se encontraron pel√≠culas</p>';
            return;
          }
          renderCategories(todasLasPeliculas);
          renderBanner(todasLasPeliculas);
          renderEstrenos(todasLasPeliculas);
          renderRecentlyAdded(todasLasPeliculas);
          renderSeries(todasLasPeliculas);
          renderAventura(todasLasPeliculas);
          renderAccion(todasLasPeliculas);
          renderComedia(todasLasPeliculas);
          renderTerror(todasLasPeliculas);
          document.getElementById('category-results').innerHTML = '';
        })
        .catch(err => {
          console.error('Error cargando datos:', err);
          document.getElementById('category-results').innerHTML = '<p class="error-message">Error cargando datos. Por favor, intenta de nuevo.</p>';
        });
    });

    // Desactivar clic derecho y teclas
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
        e.preventDefault();
      }
    });

    // Manejar descarga de app
    document.getElementById('download-app').addEventListener('click', e => {
      const install = confirm('¬øDeseas descargar e instalar la app ahora?');
      if (!install) e.preventDefault();
    });
    document.addEventListener('DOMContentLoaded', () => {
      const downloadSection = document.getElementById('app-download');
      if (window.self !== window.top) {
        downloadSection.style.display = 'none';
      } else {
        setTimeout(() => {
          downloadSection.style.display = 'none';
        }, 10000);
      }
    });
  </script>
</body>
</html>